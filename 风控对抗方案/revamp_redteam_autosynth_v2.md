# 红队评测中台 + 自动化脚本生成平台（改版方案｜内部授权评测版）
> **版本**：v2.0（Draft）  
> **日期**：2026-02-18  
> **定位**：把“攻防研究知识”转化为**可回归、可量化、可持续迭代**的质量工程与安全评测体系。  
> **重要边界**：本文仅用于**内部授权评测**与**防御质量验证**；不包含可用于未授权绕过/规避第三方平台风控的实操细节。  
>
> 本方案基于你现有资产重组：  
> - 《DeepSearch Prompt 包（红队评测中台 + 自动化脚本生成平台）》  
> - 《自动生成化质量工程架构：从人工操作捕获到自适应脚本合成的深度研究报告》  
> - 《P0/P1级别关键技术点深度分析与市场解决方案》  
> - 《浏览器自动化风控与反风控技术体系深度调研报告》  
> - 《浏览器自动化风控与反风控技术深度研究报告（2026年2月）》  
> - 《浏览器自动化风控对抗全技术方案（Web3场景专属）》  

---

## 0. 结论摘要（1页内）

### 0.1 你要交付的不是“对抗工具箱”，而是一套**评测闭环系统**
**北极星目标**：让风险控制/反自动化能力建设进入工程闭环：  
- **可复现**：任何一次风险发现，都能在隔离环境稳定复现  
- **可量化**：命中/漏报/误报、MTTE、MTTFix、回归退化率可追踪  
- **可驱动修复**：报告直接映射到责任域与修复建议，并自动回归验证  
- **可持续**：脚本/样本资产可版本化与自愈，维护成本可控

### 0.2 平台由两大产品构成（共享同一数据底座）
1) **红队评测中台（RT Evaluation Hub）**  
- 样本库（场景/向量/对手模型）  
- 评测编排与证据链采集  
- 评分看板与报告模板  
- 回归门禁（daily/weekly/release gate）

2) **自动化脚本生成平台（AutoSynth Testing）**  
- 录制与捕获：用户操作 + DOM/可访问性树 + 网络调用 + 证据包  
- 因果分析：操作-请求关联、参数依赖建模、关键断言提取  
- 脚本合成：输出“可维护资产包”而非单脚本（含自愈策略）  
- 运行与回归：容器化执行、证据留存、退化检测、自动报表

### 0.3 关键治理原则（决定能否在组织内推进）
- **合规与安全分级**：对抗实现细节必须与评测向量描述隔离存放、分级授权、全审计  
- **证据标准**：所有“成功率/拦截率/可行性”结论必须能追溯到可复现实验与条件  
- **开源优先**：开源路线两轮评测未达硬阈值才允许引入付费补位（最小范围）

---

## 1. 背景与目标

### 1.1 背景
- 风控/反自动化已从静态规则演进到“协议层 + 环境层 + 行为层 +（Web3）链上链下联动”的动态评分体系。  
- 传统脚本化自动化测试在 UI/流程高变化下维护成本高、回归不稳定，需要“捕获→分析→合成→运行”的自合成范式。  
- 你现有文档已经覆盖了大量“检测点知识”和“生成框架构想”，但缺少统一的工程交付边界、治理、安全与可观测闭环。

### 1.2 目标（必须可验收）
- 建成一套可落地到 CI/CD 的评测体系：**样本化、回归化、指标化**  
- 建成一套可持续的脚本生成体系：**降低维护成本、提高稳定性、可证据化**  
- 覆盖 Web2 与 Web3：尤其是钱包/签名/链上地址画像与链下前端交互的联动评测（仅限授权）

### 1.3 非目标（明确排除）
- 不输出任何可直接用于未授权绕过/规避第三方平台风控的“操作指南/代码/参数配置”。  
- 不提供第三方平台的规避选型或落地实施步骤（该内容属于高滥用风险资产，必须在更严格隔离下管理）。

---

## 2. 范围、合规边界与安全治理

### 2.1 授权边界（Runbook 前置条件）
- 必须有明确的**授权工单**：目标系统/范围/时间窗/负责人/回滚预案  
- 必须在**隔离环境**（或经批准的灰度环境）执行；禁止在生产进行破坏性验证  
- 必须有**证据留存与审计**：谁执行、执行了什么、结果是什么、数据如何脱敏

### 2.2 数据与密钥治理（Web3 特别重要）
- 钱包/签名相关数据必须：  
  - 使用测试专用账户与测试资金  
  - 秘钥/助记词/私钥严禁进入日志与报告  
  - 证据包需做脱敏（例如 payload/响应体字段级脱敏）

### 2.3 内容分级与隔离（建议立刻实施）
- **L0（可广泛共享）**：方法论、指标体系、架构蓝图、流程规范（不含对抗实现）  
- **L1（评测团队可见）**：评测向量、样本库 schema、runbook、证据链规范（不含绕过细节）  
- **L2（严格隔离）**：对抗工程实现细节（需要最小人数授权 + 全审计）  
> 本文属于 **L0/L1**。L2 内容只在“受控仓库”维护，且只引用其接口/产物，不暴露细节。

---

## 3. 已知信息融合对照表（继承/修正/新增）

| 现有资产 | 关键贡献 | 在新方案中的定位 | 处理方式 | 备注 |
|---|---|---|---|---|
| DeepSearch Prompt 包 | 目标、输出结构、约束、模块拆解、实施计划与付费阈值要求 | 作为**规范与验收模板** | **继承**（结构）+ **补强**（治理/证据链） | 方案输出尽量按其格式组织 |
| 自动化脚本生成框架研究 | Capture→Analysis→Synthesis→Runtime 四段式；因果关联、参数依赖、自愈 | 作为**脚本生成平台主框架** | **继承**（主框架）+ **新增**（治理、证据包、指标） | 重点补齐“资产化输出”定义 |
| P0/P1 技术点分级 | 8 个关键技术点作为对抗/检测向量分类 | 作为**评测向量分类轴** | **继承**（分类）+ **修正**（证据标准/不输出绕过实现） | 将“对抗点”降维为“评测点” |
| 风控体系深度调研报告 | 协议/环境/行为/主动探测/ML 等趋势与结构化理解 | 作为**对手模型与检测信号库** | **继承**（框架）+ **补盲**（可观测与指标映射） | 强调一致性/可解释性 |
| 风控深度研究报告（2026/2） | 系统性综述、工具生态与场景拆解 | 作为**知识背景** | **继承**（背景）+ **修正**（结论需实验支撑） | 将“建议”转成“需验证假设” |
| Web3 场景专属方案 | Web3 特有风控维度（钱包/签名/链上画像） | 作为**Web3 场景向量库输入** | **继承**（问题空间）+ **隔离**（实现细节） | 仅保留向量描述与观测点 |

---

## 4. 冲突与纠偏清单（高/中/低风险假设）

> 目的：把“看起来正确的经验结论”变成“可证伪的工程假设”，避免决策被不可复现的断言带偏。

### 4.1 高风险假设（必须先做内部基准验证）
1) **“成功率/拦截率百分比”类结论**  
- 风险：多数来自经验描述，缺少统一实验条件、样本量、对照组与复现脚本。  
- 纠偏：全部降级为“待验证假设”，纳入评测中台的基准测试跑分，不作为方案承诺。

2) **“某工具/某方案开箱即用解决 P0”类结论**  
- 风险：工具版本/浏览器版本/目标站点差异会导致结论失效；且容易被滥用。  
- 纠偏：在本文仅保留“能力需求与接口抽象”，具体工具实现放入 L2 受控仓库并做版本化评测。

3) **“只要某单点伪装即可通过”类结论**  
- 风险：当前风控普遍为多信号融合评分，单点改动不可保证整体通过。  
- 纠偏：评测向量必须按“协议/环境/行为/业务一致性”组合建模，报告必须给出信号归因。

### 4.2 中风险假设（需要补充证据链）
- 某些“检测点”是否为主流风控的普遍做法：需要在样本库里用可观测信号验证其影响权重。  
- Web3 链上画像策略的判定阈值：平台差异大，需以“可观测结果”为准，不做泛化承诺。

### 4.3 低风险假设（可先按工程实践落地）
- 评测闭环的价值：样本版本化、证据链、回归门禁与指标驱动修复，这是通用工程规律。  
- 脚本生成平台四段式框架：在多数 Web 流程中可成立，后续以数据校正参数。

---

## 5. 补盲清单：落地必须补齐的能力点

### 5.1 治理与安全（当前文档普遍缺失）
- 授权工单模板、审批链路、环境隔离标准、执行审计与留痕  
- 样本/脚本资产的权限分级（L0/L1/L2）与脱敏策略

### 5.2 证据链与可观测（当前仅零散提及）
- 统一证据包格式（trace、HAR、DOM snapshot、关键日志切片、链上事件摘要）  
- 归因所需的最小观测集与采集点（前端埋点/网关日志/风控引擎输出）

### 5.3 样本库与版本化（需要标准 schema）
- 向量描述、触发条件、期望系统响应、误报保护、风险等级、责任域映射、复现脚本/配置引用

### 5.4 指标体系（需要可计算公式）
- 命中/漏报/误报定义统一（分场景、分阈值）  
- MTTE/MTTFix、退化率、脚本稳定性与维护成本指标化

### 5.5 运行与集成（CI/CD 级落地）
- Release gate 规则、退化判定、回滚策略  
- 运行资源隔离（容器化、网络策略、密钥注入）  
- 失败分类与自动分派（元素变化/流程变化/数据变化/环境差异）

---

## 6. 总体架构蓝图（文字化架构图）

```
                 ┌──────────────────────────────────────────┐
                 │              Governance & Safety          │
                 │ 授权工单｜权限分级｜审计留痕｜脱敏策略     │
                 └───────────────┬──────────────────────────┘
                                 │
┌────────────────────────────────▼────────────────────────────────┐
│                         Data & Evidence Layer                     │
│ 样本库/向量库｜脚本资产库｜证据包仓库｜指标库｜版本与溯源         │
└───────────────┬───────────────────────────────┬─────────────────┘
                │                               │
┌───────────────▼───────────────┐     ┌─────────▼──────────────────┐
│   AutoSynth Platform           │     │   Red Team Evaluation Hub   │
│  (Capture/Analysis/Synthesis/  │     │  样本编排｜回归门禁｜报告    │
│   Runtime + Healer)            │     │  评分看板｜缺陷闭环         │
└───────────────┬───────────────┘     └─────────┬──────────────────┘
                │                               │
                └───────────────┬───────────────┘
                                │
                    ┌───────────▼───────────┐
                    │   Execution Runners    │
                    │ 容器化运行｜网络策略   │
                    │ 证据采集｜回放/回归    │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │   Target Systems       │
                    │ Web2 前端/后端/网关     │
                    │ Web3 DApp/钱包/链上    │
                    └───────────────────────┘
```

### 6.1 模块边界与数据流
- **Capture**：产生原始事件流（操作/DOM/网络/日志/链上事件摘要）  
- **Analysis**：生成因果图（操作↔请求）、参数依赖图、关键断言集合  
- **Synthesis**：生成可维护“脚本资产包”（含自愈策略与证据规范）  
- **Runtime**：执行、采集证据、输出结果、上传指标  
- **Evaluation Hub**：按样本编排评测，出报告，触发修复与回归门禁  
- **Data/Evidence**：统一存储与溯源（版本、hash、owner、可复现入口）

---

## 7. 红队评测中台（RT Evaluation Hub）

### 7.1 样本库分层（建议命名：control / adversarial / boundary）
- **control（基准）**：正常用户路径与合规高频行为（用于误报基线）  
- **adversarial-basic（对手模型-基础）**：常见自动化/异常流量形态的“可复现样本”  
- **adversarial-advanced（对手模型-高级）**：更贴近高能力对手的组合向量（细节在 L2）  
- **boundary-legit（边界合法）**：看似异常但真实存在的用户群体（例如网络抖动/无障碍模式/低端设备）

> 关键点：对抗样本用于评估防御鲁棒性，但**不得包含可直接滥用的绕过细节**。高级对手模型的“实现”与“参数”必须 L2 隔离。

### 7.2 样本元数据 Schema（建议 YAML/JSON）

```yaml
id: RT-<domain>-<vector>-<seq>
name: "<简短描述>"
category: control | adversarial-basic | adversarial-advanced | boundary-legit
scope:
  surface: [web2, web3]
  channel: [frontend, api, gateway, chain]
severity: P0 | P1 | P2
p0p1_mapping: ["CDP", "ClientHints", "TimeConsistency", "ExtensionParadox", "FrameworkSignature", "TLS_HTTP2", "FingerprintConsistency", "JS_Timing"]
business_scenario:
  product: "<产品线/业务>"
  journey: "<用户旅程节点>"
prerequisites:
  env: "<测试环境/灰度>"
  accounts: "<测试账号/钱包> (reference only)"
  data: "<测试数据集版本>"
stimulus:
  description: "<高层触发描述，不含绕过细节>"
  steps_ref: "<脚本资产包/流程ID>"
observability:
  required_signals:
    - "<前端埋点/trace>"
    - "<网关日志>"
    - "<风控引擎输出>"
    - "<链上事件摘要（如适用）>"
expected_response:
  decision: allow | challenge | rate_limit | block | step_up_auth
  notes: "<期望系统行为与理由>"
false_positive_guards:
  - "<哪些真实用户可能类似，如何避免误伤>"
evidence:
  artifacts:
    - "trace.zip"
    - "har.json"
    - "dom_snapshots/"
    - "backend_logs.jsonl"
owner:
  team: "<责任团队>"
  person: "<owner>"
versioning:
  sample_version: "1.0.0"
  last_verified: "2026-02-18"
references:
  docs: ["<内部文档链接>"]
  tickets: ["<缺陷单/修复单>"]
```

### 7.3 评测流程 Runbook（从授权到复测闭环）
1) **申请与授权**：提交评测工单（范围/时间窗/回滚/联系人）  
2) **准备与隔离**：选择环境、准备测试数据、配置证据采集、校验脱敏  
3) **执行评测**：按样本集编排运行（control + adversarial + boundary）  
4) **证据固化**：自动生成证据包与运行摘要（含版本/哈希/环境指纹摘要）  
5) **归因与分派**：将异常映射到责任域（前端/网关/风控/链上分析）  
6) **修复建议**：报告输出“可执行修复项”，明确优先级与验收条件  
7) **回归验证**：修复后自动回归；未达标禁止发布（release gate）  
8) **收敛沉淀**：样本/脚本/规则版本化；更新指标基线与风险登记

### 7.4 周期性回归机制（建议默认开启）
- **Daily（每日）**：control + 关键 P0 向量抽样（小规模）  
- **Weekly（每周）**：全量 P0 + 核心 P1（中规模）  
- **Release Gate（发布门禁）**：与发布分支绑定，必须“零 P0 退化”，P1 允许在阈值内浮动

### 7.5 报告模板（结构固定，便于对齐）
- 概览：评测范围、环境、版本、结果摘要  
- 发现列表：每条发现包含**证据链接**、归因、影响范围、复现步骤引用（不含绕过细节）  
- 风险评级：P0/P1/P2 + 业务影响  
- 修复建议：短期补丁/长期重构/观测补齐  
- 回归结果：修复前后对比、退化项、门禁结论  
- 附录：样本清单、指标明细、证据包索引

### 7.6 可量化指标（统一公式）
- **命中率（Hit Rate）** = 命中样本数 / 应命中样本数  
- **漏报率（Miss Rate）** = 漏报样本数 / 应命中样本数  
- **误报率（False Positive Rate）** = 误报样本数 / control 样本数  
- **MTTE**（Mean Time To Explain）= 从告警到归因结论的平均时长  
- **MTTFix**（Mean Time To Fix）= 从归因到修复上线的平均时长  
- **回归退化率** = 本次退化项数 / 上次通过项数  
- **证据完整率** = 证据齐全的样本数 / 总样本数（缺证据=不可验收）

### 7.7 指标到 P0/P1 八点分级的映射（作为看板维度）
| 维度 | 含义（评测视角） | 典型观测信号 |
|---|---|---|
| CDP | 自动化控制链路相关信号是否可被识别与解释 | 前端探测埋点/异常栈/策略命中 |
| Client Hints | UA/CH/JS 环境信息的一致性风险 | 请求头、JS API、策略命中 |
| Time Consistency | 多时间源一致性与事件序列合理性 | 时间序列异常、行为评分 |
| Extension Paradox | 扩展/注入机制引入的新异常信号 | 资源探测、DOM 注入痕迹 |
| Framework Signature | 框架特征与调用模式异常 | 调试端口/特征变量/模式 |
| TLS/HTTP2 | 协议层指纹与传输行为异常 | 网关 TLS/HTTP2 指纹、JA* |
| Fingerprint Consistency | 指纹跨维一致性与稳定性 | Canvas/WebGL/Audio 摘要 |
| JS Timing | JS 事件循环/交互时序异常 | promise/idle/交互间隔统计 |

---

## 8. 自动化脚本生成平台（AutoSynth Testing）

> 目标：将一次人工演示转化为“可维护脚本资产包”，并可在 CI/CD 中稳定回归。

### 8.1 Capture：捕获什么、怎么捕获（不侵入、可证据化）
**输入数据（建议最小集）**：
- 操作事件：click/input/scroll/keydown 等 + 元素语义信息（role/name/aria）  
- DOM 证据：关键帧 DOM snapshot + 可访问性树摘要  
- 网络证据：Fetch/XHR/导航请求、响应摘要、关键 header（脱敏）  
- 性能/时序：navigation timing、关键事件时间戳序列  
- 运行环境摘要：浏览器版本、OS、分辨率、时区、语言（用于复现）  
- （Web3）链上证据摘要：仅记录交易/事件 hash、区块高度、时间戳（不记录私钥/明文签名）

**实现建议（开源优先、可替换）**：
- 浏览器侧：扩展/注入采集 + CDP trace 采集（用于证据链，而非绕过）  
- 网络侧：HAR/代理捕获作为备选  
- 服务端：可选 agent 采集（用于外部依赖 mock 与回放）

> 注意：Capture 的目标是“复现与归因”，不是“规避检测”。

### 8.2 Analysis：操作-请求因果关联 + 参数依赖建模
**输出**：
- 操作↔请求因果图（event→request edges + 置信度）  
- 参数依赖图（response field → next request param）  
- 关键断言集合（UI 断言 + API 断言 + 风控决策断言）  
- 噪声过滤规则（埋点/轮询/预加载资源）

**算法策略（工程可落地）**：
- 时间窗 + 状态突变（DOM diff） + 发起栈（initiator）联合评分  
- 多次录制对比识别“动态字段”，自动参数化与变量提取  
- 失败分类器：元素变更/流程变更/数据变更/环境差异

### 8.3 Synthesis：输出“脚本资产包”而不是单脚本
**资产包结构（建议）**：
```
<test_id>/
  intent.yaml                # 测试意图与断言语义（人可读）
  flow.graph.json            # 因果图与依赖图（机器可读）
  script/
    test.spec.ts             # Playwright/Cypress 等执行脚本
    selectors.ts             # 选择器策略（含多路定位）
    assertions.ts            # UI/API 断言
  evidence/
    capture.har              # 脱敏后的 HAR（可选）
    trace.zip                # 执行 trace（可选）
  heal/
    healer.rules.yaml        # 自愈规则（元素/流程/数据）
  meta.json                  # 版本、环境摘要、hash、owner
```

**生成原则**：
- 首选语义定位（role/name）与多路定位冗余  
- 自动等待基于状态与网络空闲（避免硬编码 sleep）  
- 断言必须分层：UI 层、API 层、风险决策层（如适用）  
- 所有敏感数据一律引用“变量”，并在运行时注入（密钥不落盘）

### 8.4 Runtime：运行、回归与证据闭环
- 容器化 Runner（固定浏览器版本 + 依赖锁定）  
- 统一日志与 trace：每次运行产出证据包与指标上报  
- 失败自动分诊：按失败类型分派到对应 owner  
- 与 CI/CD 集成：PR 校验、夜间回归、发布门禁

### 8.5 自愈策略（只描述“防御性自愈”，不涉及绕过）
- **元素变化**：定位符候选集、可访问性树回退、DOM 相似度匹配  
- **流程变化**：分支识别（可选步骤）、可重试节点、幂等处理  
- **数据变化**：动态参数提取、测试数据工厂、mock/回放（可选）  
- **环境差异**：时区/语言/分辨率差异显式配置，避免隐式漂移

### 8.6 失败场景与降级策略
- 遇到不可自动化环节（例如二次验证）：降级为“半自动节点”，只记录证据与人工确认结果（避免强行自动化导致误报）。

---

## 9. 三条技术路线（开源优先）

> 这里给的是**工程路线**，不是“对抗落地指南”。任何高风险对手模型模拟实现必须放到 L2。

### 9.1 路线 A：纯开源路线（默认）
- **适用**：预算敏感；希望可审计、可二次开发；内部评测为主  
- **核心策略**：开源采集 + 开源 runner + 自研 analysis/synthesis（轻量）  
- **优势**：成本低、透明可控、易融入现有 CI/CD  
- **失败模式**：复杂动态流程自愈不足；对手模型高级样本需要更多工程投入  
- **维护成本**：中（需要版本治理与基准评测）

### 9.2 路线 B：混合路线（开源底座 + 关键环节增强）
- **适用**：希望更快达到“可用版”，但保持核心资产在内  
- **策略**：Capture/Runner 开源 + Analysis/Synthesis 引入少量成熟组件（如流量回放/Mock）  
- **优势**：更快闭环；证据链更完整  
- **失败模式**：组件间 schema 不统一；集成成本被低估  
- **维护成本**：中高（需要接口适配与版本锁定）

### 9.3 路线 C：最小付费补位路线（仅在触发阈值后）
- **适用**：开源路线连续两轮未达目标指标，且问题集中在某一短板能力  
- **策略**：只补齐缺口模块（例如自愈、录制分析、企业级报告），其余保留开源与自研  
- **优势**：最小化锁定与成本  
- **失败模式**：供应商黑盒导致证据链不透明；退出机制不健全  
- **维护成本**：低到中（取决于供应商接口稳定性）

---

## 10. 4/8/12 周实施计划（带验收标准）

### 10.1 4 周：MVP（跑通闭环）
**目标**：2 条黄金链路（Web2 1条 + Web3 1条）实现“录制→生成→回归→报告”。  
**里程碑**：
- Week1：样本 schema + 证据包格式 + 授权 runbook 上线  
- Week2：Capture MVP（操作+网络）+ 基础 Analysis（时间窗因果）  
- Week3：Synthesis MVP（生成可执行脚本）+ Runtime 容器化跑通  
- Week4：Evaluation Hub MVP（跑分/报告/指标上报）

**交付物**：
- 样本库 v0（≥20 个样本：control 10 / adversarial-basic 8 / boundary 2）  
- 脚本资产包 v0（≥2 条端到端流程）  
- 指标看板 v0（命中/误报/MTTE/MTTFix/稳定性）  
- 报告模板 v0 + 2 份示例报告

**验收标准（硬阈值）**：
- 2 条流程在 3 次连续运行中成功率 ≥ 80%  
- 证据完整率 ≥ 95%  
- P0 样本至少覆盖 4 个维度（按八点映射任选）

### 10.2 8 周：可用版（覆盖核心风险面）
**目标**：样本库与回归门禁可用于日常迭代；失败可自动分诊。  
**新增**：
- 参数依赖建模（跨请求变量提取）  
- 自愈 v1（元素变化 + 数据变化）  
- weekly 回归 + release gate 接入 CI/CD  
- 责任域映射（自动分派缺陷单）

**验收标准**：
- 关键流程回归稳定性 ≥ 90%（连续 10 次）  
- P0 覆盖完整 8 维映射中 ≥ 6 维  
- MTTE 中位数 ≤ 4 小时（以内部流程为准）

### 10.3 12 周：完整版（体系化运营）
**目标**：形成“评测驱动修复”的常态机制，脚本维护成本可量化并下降。  
**新增**：
- 自愈 v2（流程变化/分支）  
- 对手模型 advanced 样本在 L2 管理并接入（细节隔离）  
- 退化检测与自动回滚建议  
- 指标失真校正（剔除环境波动噪声）

**验收标准**：
- 发布门禁：P0 退化 = 0；P1 退化 ≤ 阈值（业务定义）  
- 维护成本指标（人时/周）较 4 周基线下降 ≥ 30%  
- 样本库版本化与审计链闭环（可追溯到每次发布）

---

## 11. 指标与统一评分体系（可直接做看板字段）

### 11.1 三大优先级
1) **脚本生成成功率**：生成可执行脚本并通过基准回归的比例  
2) **回归稳定性**：同版本多次执行成功率与方差  
3) **维护成本**：脚本修复人时、平均修复次数、变更触发频率

### 11.2 指标定义（示例公式）
- **ScriptGen Pass Rate** = 通过回归的生成脚本数 / 生成脚本数  
- **Stability（σ）** = 同一用例多次运行成功(0/1)的标准差  
- **Maintenance Cost** = 修复人时 +（回滚成本 * 权重）  
- **Quality Score（建议）** = w1*PassRate + w2*(1-σ) + w3*(1-NormalizedCost)

> 阈值建议：在 MVP 阶段只做趋势；8/12 周阶段再做硬门槛。

### 11.3 指标失真风险与校正
- 环境抖动导致误判：使用“环境标签”分桶统计（浏览器版本/网络条件）  
- 样本漂移：样本必须版本化并标记 last_verified  
- 证据缺失：缺证据不计入“通过”，否则指标会被“无证据通过”污染

---

## 12. 风险清单与规避策略（触发条件｜影响｜信号｜缓解｜回滚）

### 12.1 技术风险
- **Capture 不完整**：关键请求/关键 DOM 未捕获 → 脚本不可复现  
  - 信号：证据完整率下降、因果图置信度低  
  - 缓解：增加 capture 插桩点、补充 trace  
  - 回滚：降级为半自动节点

- **自愈过度**：脚本“修复”但掩盖真实缺陷  
  - 信号：断言通过但业务指标异常、证据不一致  
  - 缓解：自愈必须输出“修复解释”与证据对比  
  - 回滚：关闭自愈策略、回退到上版选择器

### 12.2 数据风险
- **敏感数据泄露**（账号/钱包）  
  - 信号：日志出现疑似私密字段  
  - 缓解：字段级脱敏、密钥只在运行时注入  
  - 回滚：立即停跑、吊销测试密钥、审计

### 12.3 流程风险
- **授权不清导致合规风险**  
  - 信号：无工单执行、环境越权  
  - 缓解：Runner 强制校验授权 token  
  - 回滚：冻结执行权限

### 12.4 运行风险
- **CI/CD 门禁误伤发布**  
  - 信号：大量 false blocking  
  - 缓解：分级门禁（warning→blocking），先做观察期  
  - 回滚：降级门禁等级，但保留证据采集

---

## 13. 付费方案启用阈值与决策树（硬规则）

### 13.1 启用条件（必须同时满足）
- 开源方案在同一目标范围内 **连续两轮**（例如两次 weekly 或两次 release gate）未达标  
- 未达标原因经归因后确认：主要瓶颈集中在某个模块能力（例如自愈/录制分析/企业报告）  
- 已尝试至少 1 个开源备选方案仍失败（有证据与对比数据）

### 13.2 最小范围原则
- 只购买/引入“补短板模块”，不替换整个平台底座  
- 必须有退出机制：评估期、替代方案、数据可迁移

### 13.3 决策树（文字版）
1) 是否两轮未达标？否→继续开源迭代  
2) 能否用开源备选补齐？能→继续开源；否→进入付费评估  
3) 付费是否仅覆盖缺口模块且可退出？否→拒绝；是→试点  
4) 试点是否显著提升指标且不破坏证据链？否→退出；是→有限扩展

---

## 14. 本周可执行清单（按天）

> 目标：在 5 个工作日内把“治理 + schema + MVP 闭环骨架”落地到仓库。

- **Day1**：确定 L0/L1/L2 分级与仓库权限；落地授权工单模板与审计字段  
- **Day2**：实现样本 schema（YAML/JSON）+ 证据包规范（目录/命名/脱敏）  
- **Day3**：Capture MVP：操作事件 + 网络事件合并成统一事件流  
- **Day4**：Analysis MVP：时间窗因果 + 噪声过滤；输出 flow.graph.json  
- **Day5**：Synthesis+Runtime MVP：生成 1 条脚本资产包并在容器内跑通；产出第一份报告

---

## 附录 A：术语表（建议全员统一）
- **样本（Sample）**：一个可复现评测用例（包含触发描述、期望响应、证据要求）  
- **向量（Vector）**：样本所针对的风险信号类别（例如协议层/环境层/行为层）  
- **证据包（Evidence Pack）**：一次评测运行的全部可追溯工件集合  
- **脚本资产包（Test Asset Pack）**：可维护、可版本化、可回归的脚本交付单位  
- **对手模型（Adversary Model）**：用于评测的攻击者能力假设（实现细节 L2）

---

## 附录 B：报告模板（可直接复制）
1. 概览（范围/环境/版本/结论）  
2. 结果摘要（通过/失败/门禁结论）  
3. 发现明细（证据链接/归因/修复建议/风险评级）  
4. 指标与趋势（命中/误报/MTTE/MTTFix/退化率）  
5. 样本清单与版本（含 last_verified）  
6. 证据包索引（hash/路径/权限）

---
